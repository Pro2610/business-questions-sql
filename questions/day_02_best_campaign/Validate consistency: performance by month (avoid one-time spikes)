SELECT
  campaign_id,
  campaign_name,
  FORMAT_DATE('%Y-%m', DATE(payment_date)) AS month,
  SUM(revenue_amount) AS revenue,
  COUNT(DISTINCT user_id) AS paid_users,
  SAFE_DIVIDE(SUM(revenue_amount), COUNT(DISTINCT user_id)) AS arppu
FROM `project.dataset.payments`
WHERE DATE(payment_date) BETWEEN '2025-01-01' AND '2025-03-31'
GROUP BY 1,2,3
ORDER BY campaign_id, month;
