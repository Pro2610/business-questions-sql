WITH user_avg AS (
  SELECT
    SAFE_DIVIDE(SUM(revenue_amount), COUNT(DISTINCT user_id)) AS avg_user_revenue
  FROM `project.dataset.payments`
),
reactivated_avg AS (
  SELECT
    SAFE_DIVIDE(SUM(reactivation_revenue), COUNT(DISTINCT user_id)) AS avg_reactivated_revenue
  FROM reactivations
)
SELECT
  avg_user_revenue,
  avg_reactivated_revenue,
  SAFE_DIVIDE(avg_reactivated_revenue, avg_user_revenue) AS reactivated_vs_avg_ratio
FROM user_avg, reactivated_avg;
